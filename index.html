<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pizza Negotiator 3D</title>
<style>
    body { margin:0; overflow:hidden; background:#111; font-family:sans-serif; }
    #ui {
        position:absolute; bottom:10px; left:50%; transform:translateX(-50%);
        text-align:center; background:rgba(0,0,0,0.5); padding:10px; border-radius:8px;
        width:90%; max-width:500px; color:white;
    }
    input { width:70%; padding:6px; font-size:16px; }
    button { padding:6px 10px; font-size:16px; margin-left:5px; }
    #stats { margin-top:6px; font-size:14px; }
    .bar { height:12px; background:#333; border-radius:6px; overflow:hidden; margin-top:4px; }
    .fill { height:100%; background:lime; width:0%; transition:width 0.3s; }
    .fill.red { background:red; }
</style>
</head>
<body>
<div id="ui">
    <div id="personality">Personality: ???</div>
    <input type="text" id="argument" placeholder="Type your argument..." />
    <button id="sendBtn">Convince</button>
    <div id="stats">
        Agreement:
        <div class="bar"><div id="agreeBar" class="fill"></div></div>
        Patience:
        <div class="bar"><div id="patienceBar" class="fill red"></div></div>
    </div>
    <div id="message"></div>
</div>
<script src="https://cdn.jsdelivr.net/npm/three@0.157.0/build/three.min.js"></script>
<script>
// Scene setup
let scene = new THREE.Scene();
scene.background = new THREE.Color(0x444444);

let camera = new THREE.PerspectiveCamera(60, window.innerWidth/window.innerHeight, 0.1, 1000);
let renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

// Lighting - brighter
let ambient = new THREE.AmbientLight(0xffffff, 1.2);
scene.add(ambient);
let dirLight = new THREE.DirectionalLight(0xffffff, 1.0);
dirLight.position.set(3, 5, 4);
scene.add(dirLight);

// Floor
let floorGeo = new THREE.PlaneGeometry(20,20);
let floorMat = new THREE.MeshStandardMaterial({color:0x888888});
let floor = new THREE.Mesh(floorGeo, floorMat);
floor.rotation.x = -Math.PI/2;
scene.add(floor);

// Table
let tableGeo = new THREE.BoxGeometry(3,0.2,2);
let tableMat = new THREE.MeshStandardMaterial({color:0x8B4513});
let table = new THREE.Mesh(tableGeo, tableMat);
table.position.set(0,0.6,0);
scene.add(table);

// Parent model
let bodyGeo = new THREE.CylinderGeometry(0.5,0.5,1.2,6);
let bodyMat = new THREE.MeshStandardMaterial({color:0xffcc99});
let body = new THREE.Mesh(bodyGeo, bodyMat);
body.position.set(0,1.4,0);
scene.add(body);

let headGeo = new THREE.SphereGeometry(0.4,16,16);
let headMat = new THREE.MeshStandardMaterial({color:0xffddaa});
let head = new THREE.Mesh(headGeo, headMat);
head.position.set(0,2.3,0);
scene.add(head);

// Camera locked to face the parent
camera.position.set(0,1.8,3);
camera.lookAt(0,1.8,0);

// Personalities
const personalities = [
    {name:"Strict", likes:["homework","grades"], hates:["pizza","junk","game"]},
    {name:"Frugal", likes:["cheap","discount","free"], hates:["expensive","waste","delivery"]},
    {name:"Health-conscious", likes:["healthy","salad","protein"], hates:["greasy","fat","oil","pizza"]},
    {name:"Distracted", likes:["quick","fast"], hates:["long","boring"]},
    {name:"Suspicious", likes:["truth","honest"], hates:["lie","fake"]}
];
let current = personalities[Math.floor(Math.random()*personalities.length)];
document.getElementById("personality").innerText = "Personality: " + current.name;

// Stats
let agreement = 0;
let patience = 100;
function updateBars(){
    document.getElementById("agreeBar").style.width = agreement + "%";
    document.getElementById("patienceBar").style.width = patience + "%";
}
updateBars();

function processArgument(text){
    let t = text.toLowerCase();
    let scoreChange = 0;
    let patienceLoss = 10;
    current.likes.forEach(word=>{ if(t.includes(word)) scoreChange+=15; });
    current.hates.forEach(word=>{ if(t.includes(word)) scoreChange-=20; });
    if(t.includes("pizza")) scoreChange += 5; 
    agreement = Math.max(0, Math.min(100, agreement + scoreChange));
    patience = Math.max(0, patience - patienceLoss);
    let msg = "";
    if(scoreChange>0) msg = "They seem slightly convinced.";
    if(scoreChange<0) msg = "They don't like what you said.";
    if(scoreChange===0) msg = "They look unconvinced.";
    if(agreement>=100) msg = "They agreed! Pizza time!";
    if(patience<=0 && agreement<100) msg = "They ran out of patience. No pizza.";
    document.getElementById("message").innerText = msg;
    updateBars();
}

document.getElementById("sendBtn").addEventListener("click", ()=>{
    if(agreement>=100 || patience<=0) return;
    let arg = document.getElementById("argument").value.trim();
    if(arg==="") return;
    processArgument(arg);
    document.getElementById("argument").value = "";
});

// Animation loop
function animate(){
    requestAnimationFrame(animate);
    head.rotation.y = Math.sin(Date.now()/800)*0.2;
    renderer.render(scene, camera);
}
animate();

// Resize
window.addEventListener("resize", ()=>{
    camera.aspect = window.innerWidth/window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight);
});
</script>
</body>
</html>
